#!/usr/bin/env bash
set -euo pipefail

if [[ "$(id -u)" -ne 0 ]]; then
  echo "Run as root (sudo)" >&2
  exit 1
fi

if [[ ! -f /etc/asterisk/logger.messages.conf ]]; then
  echo "Missing /etc/asterisk/logger.messages.conf" >&2
  exit 1
fi

cp -f /etc/asterisk/logger.messages.conf /etc/asterisk/logger.conf

# Перечитываем конфиг логгера, не перезапуская Asterisk
/usr/sbin/asterisk -rx "logger reload" >/dev/null 2>&1 || true
/usr/sbin/asterisk -rx "logger rotate" >/dev/null 2>&1 || true

echo "OK: full logging disabled (logger.conf -> logger.messages.conf)"

